<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Подсчет посетителей в магазине</title>
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <main class="container">
      <header>
        <h1>Подсчет посетителей в магазине</h1>
        <p>Загрузите изображение или видео, либо подключите поток для подсчёта людей.</p>
      </header>

      <section class="tabs panel">
        <div class="tab-list" role="tablist" aria-label="Режим распознавания">
          <button class="tab active" role="tab" data-tab="image">Изображение</button>
          <button class="tab" role="tab" data-tab="video">Видео</button>
          <button class="tab disabled" role="tab" data-tab="stream" disabled aria-disabled="true">
            Поток
          </button>
          <button class="tab" role="tab" data-tab="history">История</button>
        </div>

        <div class="tab-panel active" id="tab-image" role="tabpanel">
          <h2>Загрузка изображения</h2>
          <input type="file" id="imageInput" accept="image/*" />
          <section class="panel results results-panel">
            <h2>Результаты</h2>
            <div class="result-grid">
              <div>
                <span class="label">Количество</span>
                <span data-field="currentCount">-</span>
              </div>
              <div>
                <span class="label">Статус</span>
                <span data-field="status">ожидание</span>
              </div>
            </div>
            <pre data-field="error" class="error"></pre>
            <div class="image-preview">
              <img data-field="imagePreview" alt="Предпросмотр обнаруженных людей" />
            </div>
          </section>
        </div>

        <div class="tab-panel" id="tab-video" role="tabpanel">
          <h2>Загрузка видео</h2>
          <input type="file" id="videoInput" accept="video/mp4,video/avi,video/webm" />
          <section class="panel results results-panel">
            <h2>Результаты</h2>
            <div class="result-grid">
              <div>
                <span class="label">Текущее количество</span>
                <span data-field="currentCount">-</span>
              </div>
              <div>
                <span class="label">Максимум</span>
                <span data-field="maxCount">-</span>
              </div>
              <div>
                <span class="label">Статус</span>
                <span data-field="status">ожидание</span>
              </div>
            </div>
            <pre data-field="error" class="error"></pre>
            <div class="video-preview">
              <video data-field="videoPreview" controls playsinline preload="metadata"></video>
            </div>
            <div class="stream-preview">
              <img data-field="streamPreview" alt="Поток с метками объектов" />
            </div>
          </section>
        </div>

        <div class="tab-panel" id="tab-stream" role="tabpanel">
          <h2>Ссылка на поток (RTSP/HTTP)</h2>
          <input type="url" id="streamInput" placeholder="rtsp://... или http://..." />
          <section class="panel results results-panel">
            <h2>Результаты</h2>
            <div class="result-grid">
              <div>
                <span class="label">Текущее количество</span>
                <span data-field="currentCount">-</span>
              </div>
              <div>
                <span class="label">Максимум</span>
                <span data-field="maxCount">-</span>
              </div>
              <div>
                <span class="label">Статус</span>
                <span data-field="status">ожидание</span>
              </div>
            </div>
            <pre data-field="error" class="error"></pre>
            <div class="stream-preview">
              <img data-field="streamPreview" alt="Поток с метками объектов" />
            </div>
          </section>
        </div>

        <div class="tab-panel" id="tab-history" role="tabpanel">
          <h2>История запросов</h2>
          <a class="history-export" href="/api/history/excel" target="_blank" rel="noreferrer">
            Скачать Excel
          </a>
          <div id="historyEmpty" class="history-empty">Нет данных</div>
          <div class="history-table">
            <table>
              <thead>
                <tr>
                  <th>Тип</th>
                  <th>Файл</th>
                  <th>Длительность</th>
                  <th>Количество людей</th>
                  <th>Время</th>
                </tr>
              </thead>
              <tbody id="historyList"></tbody>
            </table>
          </div>
        </div>
      </section>

      <section class="panel" id="controlsPanel">
        <div class="controls">
          <label data-control="fps">
            FPS
            <input type="number" id="fpsInput" min="1" max="30" value="5" />
          </label>
          <label data-control="max-seconds">
            Макс. секунд (0 = без лимита)
            <input type="number" id="maxSecondsInput" min="0" value="0" />
          </label>
          <label data-control="conf">
            Точность
            <input type="number" id="confInput" min="0" max="1" step="0.05" value="0.25" />
          </label>
        </div>
        <button id="startButton" disabled>Запустить обработку</button>
      </section>

    </main>

    <script src="/static/app.js?v=1" defer onerror="console.error('app.js load failed')"></script>
  </body>
</html>
